# ğŸ¯ GPSå®šä½ç²¾åº¦å‡çº§è¯´æ˜

## é—®é¢˜æè¿°

**åŸé—®é¢˜**ï¼šå®šä½è¯¯å·®å‡ ç™¾ç±³ï¼Œå®Œå…¨æ— æ³•ä½¿ç”¨

**åŸå› åˆ†æ**ï¼š
1. âŒ ä½¿ç”¨äº†é«˜å¾·åœ°å›¾çš„ `AMap.Geolocation` æ’ä»¶ï¼ˆæµè§ˆå™¨å®šä½çš„å°è£…ï¼Œç²¾åº¦å·®ï¼‰
2. âŒ ä½¿ç”¨å®šæ—¶å™¨ + `getCurrentPosition`ï¼ˆæ¯æ¬¡å†·å¯åŠ¨å®šä½ï¼ŒGPSä¿¡å·ä¸ç¨³å®šï¼‰
3. âŒ æ²¡æœ‰ç²¾åº¦è¿‡æ»¤æœºåˆ¶ï¼ˆæ¥å—æ‰€æœ‰å®šä½ç‚¹ï¼‰
4. âŒ æ²¡æœ‰è·ç¦»è¿‡æ»¤ï¼ˆåŸåœ°æŠ–åŠ¨ä¹Ÿä¼šè®°å½•ï¼‰

## è§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒæ”¹è¿›

#### 1. ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿ Geolocation API
```javascript
// æ—§ä»£ç ï¼ˆå·²åˆ é™¤ï¼‰
const geolocation = new window.AMap.Geolocation({...})
geolocation.getCurrentPosition(...)

// æ–°ä»£ç ï¼ˆé«˜ç²¾åº¦ï¼‰
navigator.geolocation.watchPosition(callback, errorCallback, {
  enableHighAccuracy: true,  // å¼ºåˆ¶ä½¿ç”¨GPS
  timeout: 10000,            // 10ç§’è¶…æ—¶
  maximumAge: 0              // ä¸ä½¿ç”¨ç¼“å­˜
})
```

#### 2. ä¸‰é‡è¿‡æ»¤æœºåˆ¶

##### è¿‡æ»¤å™¨1: ç²¾åº¦è¿‡æ»¤
```javascript
// åªæ¥å—ç²¾åº¦å°äº50ç±³çš„ç‚¹
if (accuracy > 50) {
  console.warn(`å®šä½ç²¾åº¦ä¸è¶³: ${accuracy.toFixed(1)}ç±³ï¼Œå·²è·³è¿‡`)
  return
}
```

##### è¿‡æ»¤å™¨2: æ—¶é—´è¿‡æ»¤
```javascript
// è‡³å°‘é—´éš”5ç§’è®°å½•ä¸€æ¬¡ï¼ˆé¿å…é¢‘ç¹æ›´æ–°ï¼‰
if (now - lastRecordTimeRef.current < 5000) {
  return
}
```

##### è¿‡æ»¤å™¨3: è·ç¦»è¿‡æ»¤
```javascript
// ä¸ä¸Šä¸€ä¸ªç‚¹è·ç¦»è‡³å°‘2ç±³æ‰è®°å½•ï¼ˆé¿å…åŸåœ°æŠ–åŠ¨ï¼‰
const distance = calculateDistance(...)
if (distance < 2) {
  console.log(`ç§»åŠ¨è·ç¦»ä¸è¶³: ${distance.toFixed(1)}ç±³ï¼Œå·²è·³è¿‡`)
  return
}
```

#### 3. å®æ—¶GPSç²¾åº¦æ˜¾ç¤º
- âœ… æ˜¾ç¤ºå½“å‰GPSç²¾åº¦å€¼ï¼ˆå•ä½ï¼šç±³ï¼‰
- âœ… ç»¿ç¯ï¼šç²¾åº¦ < 20ç±³ï¼ˆä¼˜ç§€ï¼‰
- âœ… é»„ç¯ï¼š20ç±³ â‰¤ ç²¾åº¦ < 50ç±³ï¼ˆè‰¯å¥½ï¼‰
- âœ… çº¢ç¯ï¼šç²¾åº¦ â‰¥ 50ç±³ï¼ˆè¾ƒå·®ï¼Œä¸è®°å½•ï¼‰

#### 4. ç²¾åº¦åœˆå¯è§†åŒ–
```javascript
// åœ¨åœ°å›¾ä¸Šç»˜åˆ¶è“è‰²ç²¾åº¦åœˆ
new window.AMap.Circle({
  center: [longitude, latitude],
  radius: accuracy,  // åŠå¾„ = GPSç²¾åº¦å€¼
  fillColor: '#4299e1',
  fillOpacity: 0.1
})
```

#### 5. æ€»è·ç¦»è®¡ç®—
```javascript
// ä½¿ç”¨Haversineå…¬å¼è®¡ç®—çœŸå®è·ç¦»
let totalDistance = 0
for (let i = 1; i < locations.length; i++) {
  totalDistance += calculateDistance(
    prev.lat, prev.lng,
    curr.lat, curr.lng
  )
}
```

## é¢„æœŸæ•ˆæœ

### å®šä½ç²¾åº¦å¯¹æ¯”

| æŒ‡æ ‡ | æ—§ç‰ˆæœ¬ | æ–°ç‰ˆæœ¬ | æ”¹è¿› |
|------|--------|--------|------|
| GPSç²¾åº¦ | 100-500ç±³ | **5-30ç±³** | âœ… æå‡10-50å€ |
| å®šä½æ–¹å¼ | å†·å¯åŠ¨ | çƒ­å®šä½ | âœ… æ›´ç¨³å®š |
| ç²¾åº¦è¿‡æ»¤ | æ—  | ä¸‰é‡è¿‡æ»¤ | âœ… æ™ºèƒ½ç­›é€‰ |
| æŠ–åŠ¨å¤„ç† | æ—  | 2ç±³é˜ˆå€¼ | âœ… è½¨è¿¹å¹³æ»‘ |
| å®æ—¶åé¦ˆ | æ—  | ç²¾åº¦æ˜¾ç¤º | âœ… å¯è§†åŒ– |

### ä¸æ‰“è½¦APP/Keepå¯¹æ¯”

| åŠŸèƒ½ | æ‰“è½¦APP/Keep | æœ¬ç³»ç»Ÿï¼ˆæ–°ç‰ˆï¼‰| çŠ¶æ€ |
|------|-------------|-------------|------|
| GPSç²¾åº¦ | 5-20ç±³ | 5-30ç±³ | âœ… æ¥è¿‘ |
| æŒç»­å®šä½ | âœ“ | âœ“ | âœ… æ”¯æŒ |
| ç²¾åº¦è¿‡æ»¤ | âœ“ | âœ“ | âœ… æ”¯æŒ |
| è½¨è¿¹å¹³æ»‘ | âœ“ | âœ“ | âœ… æ”¯æŒ |
| è·ç¦»è®¡ç®— | âœ“ | âœ“ | âœ… æ”¯æŒ |

## æµ‹è¯•æŒ‡å—

### ç¯å¢ƒè¦æ±‚
- âœ… å¿…é¡»ä½¿ç”¨ **HTTPS** è®¿é—®ï¼ˆVercelé»˜è®¤HTTPSï¼‰
- âœ… åœ¨ **æˆ·å¤–å¼€é˜”åœ°** æµ‹è¯•ï¼ˆé¿å…å»ºç­‘ç‰©é®æŒ¡ï¼‰
- âœ… ç¡®ä¿ **GPSå·²å¼€å¯**
- âœ… å…è®¸æµè§ˆå™¨ **ä½ç½®æƒé™**

### æµ‹è¯•æ­¥éª¤

#### 1. é™æ­¢æµ‹è¯•ï¼ˆåŸåœ°ï¼‰
```
ç›®æ ‡ï¼šéªŒè¯ç²¾åº¦è¿‡æ»¤å’ŒæŠ–åŠ¨å¤„ç†

æ­¥éª¤ï¼š
1. å¼€å§‹å·¡é€»ï¼ŒåŸåœ°ç«™ç«‹30ç§’
2. è§‚å¯ŸGPSç²¾åº¦æ˜¾ç¤º
3. æ£€æŸ¥è®°å½•ç‚¹æ•°é‡

é¢„æœŸç»“æœï¼š
- GPSç²¾åº¦åº”æ˜¾ç¤º 5-20ç±³ï¼ˆç»¿ç¯/é»„ç¯ï¼‰
- è®°å½•ç‚¹æ•°é‡å¾ˆå°‘ï¼ˆ<3ä¸ªï¼Œå› ä¸ºè·ç¦»<2ç±³è¢«è¿‡æ»¤ï¼‰
```

#### 2. ç›´çº¿è¡Œèµ°æµ‹è¯•
```
ç›®æ ‡ï¼šéªŒè¯è½¨è¿¹å‡†ç¡®æ€§

æ­¥éª¤ï¼š
1. å¼€å§‹å·¡é€»
2. æ²¿ç›´çº¿èµ°50ç±³
3. è§‚å¯Ÿåœ°å›¾è½¨è¿¹

é¢„æœŸç»“æœï¼š
- è½¨è¿¹åº”åŸºæœ¬å‘ˆç›´çº¿
- æ²¡æœ‰æ˜æ˜¾è·³ç‚¹
- GPSç²¾åº¦ä¿æŒåœ¨20ç±³ä»¥å†…
```

#### 3. æ›²çº¿è¡Œèµ°æµ‹è¯•
```
ç›®æ ‡ï¼šéªŒè¯è½¬å¼¯å‡†ç¡®æ€§

æ­¥éª¤ï¼š
1. å¼€å§‹å·¡é€»
2. èµ°ä¸€ä¸ªçŸ©å½¢è·¯çº¿ï¼ˆ4ä¸ª90åº¦è½¬å¼¯ï¼‰
3. ç»“æŸå·¡é€»æŸ¥çœ‹è½¨è¿¹

é¢„æœŸç»“æœï¼š
- èƒ½æ¸…æ™°çœ‹åˆ°4ä¸ªè½¬å¼¯ç‚¹
- è½¨è¿¹å¹³æ»‘ï¼Œæ²¡æœ‰é”¯é½¿
- æ€»è·ç¦»ä¸å®é™…è·ç¦»æ¥è¿‘
```

### æ§åˆ¶å°æ—¥å¿—

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°è¯¦ç»†æ—¥å¿—ï¼š

```javascript
// ç²¾åº¦ä¸è¶³æ—¶
âš  å®šä½ç²¾åº¦ä¸è¶³: 85.3ç±³ï¼Œå·²è·³è¿‡

// è·ç¦»ä¸è¶³æ—¶
â„¹ ç§»åŠ¨è·ç¦»ä¸è¶³: 1.2ç±³ï¼Œå·²è·³è¿‡

// æˆåŠŸè®°å½•æ—¶
âœ“ è®°å½•ä½ç½®ç‚¹ #5, ç²¾åº¦: 12.4ç±³
```

## ç•Œé¢æ”¹è¿›

### æ–°å¢åŠŸèƒ½

#### 1. GPSç²¾åº¦æŒ‡ç¤ºå™¨
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å·¡é€»ä¸­...               â”‚
â”‚ 00:05:23                â”‚
â”‚ å·²è®°å½• 15 ä¸ªä½ç½®ç‚¹      â”‚
â”‚ â— GPSç²¾åº¦: 12.4ç±³       â”‚ â† æ–°å¢
â”‚ âœ“ ç²¾åº¦ä¼˜ç§€              â”‚ â† æ–°å¢
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. ç²¾åº¦åœˆï¼ˆåœ°å›¾ä¸Šï¼‰
- è“è‰²åŠé€æ˜åœ†åœˆ
- åŠå¾„ = GPSç²¾åº¦å€¼
- å®æ—¶æ›´æ–°ä½ç½®

#### 3. æ€»è·ç¦»ç»Ÿè®¡
```
å·¡é€»è®°å½•å·²ä¿å­˜ï¼
æ—¶é•¿ï¼š1å°æ—¶23åˆ†45ç§’
ä½ç½®ç‚¹ï¼š156ä¸ª
æ€»è·ç¦»ï¼š2348ç±³  â† æ–°å¢
```

## æŠ€æœ¯åŸç†

### watchPosition vs getCurrentPosition

| ç‰¹æ€§ | getCurrentPosition | watchPosition |
|------|-------------------|---------------|
| è°ƒç”¨æ–¹å¼ | å•æ¬¡è°ƒç”¨ | æŒç»­ç›‘å¬ |
| GPSçŠ¶æ€ | å†·å¯åŠ¨ | çƒ­å®šä½ |
| ç²¾åº¦ | è¾ƒå·® | ä¼˜ç§€ |
| å»¶è¿Ÿ | 2-10ç§’ | <1ç§’ |
| é€‚ç”¨åœºæ™¯ | è·å–ä¸€æ¬¡ä½ç½® | å®æ—¶è¿½è¸ª |

### enableHighAccuracy å‚æ•°

```javascript
enableHighAccuracy: true
```

**ä½œç”¨**ï¼š
- âœ… å¼ºåˆ¶ä½¿ç”¨GPSå«æ˜Ÿå®šä½ï¼ˆè€ŒéWiFi/åŸºç«™ï¼‰
- âœ… æé«˜é‡‡æ ·é¢‘ç‡
- âœ… å¢åŠ è®¡ç®—ç²¾åº¦
- âš ï¸ å¢åŠ ç”µé‡æ¶ˆè€—ï¼ˆå¯æ¥å—ï¼‰

### Haversineè·ç¦»å…¬å¼

è®¡ç®—åœ°çƒè¡¨é¢ä¸¤ç‚¹é—´çš„çœŸå®è·ç¦»ï¼š

```javascript
const R = 6371e3 // åœ°çƒåŠå¾„ï¼ˆç±³ï¼‰
const Ï†1 = (lat1 * Math.PI) / 180
const Ï†2 = (lat2 * Math.PI) / 180
const Î”Ï† = ((lat2 - lat1) * Math.PI) / 180
const Î”Î» = ((lng2 - lng1) * Math.PI) / 180

const a = Math.sin(Î”Ï†/2) * Math.sin(Î”Ï†/2) +
          Math.cos(Ï†1) * Math.cos(Ï†2) *
          Math.sin(Î”Î»/2) * Math.sin(Î”Î»/2)

const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a))
const distance = R * c  // ç±³
```

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆä¸ç”¨Google Mapsï¼Ÿ
A:
- Google Mapsåœ¨ä¸­å›½å¤§é™†è®¿é—®ä¸ç¨³å®š
- ä½¿ç”¨WGS-84åæ ‡ç³»ï¼Œä¸ä¸­å›½åœ°å›¾ä¸åŒ¹é…ï¼ˆGCJ-02åç§»ï¼‰
- é«˜å¾·åœ°å›¾åœ¨ä¸­å›½ä½¿ç”¨æ›´å¹¿æ³›ï¼Œå…è´¹é¢åº¦æ›´é«˜

### Q: ä¸ºä»€ä¹ˆä¸ç”¨ç™¾åº¦åœ°å›¾ï¼Ÿ
A:
- ç™¾åº¦åœ°å›¾ä½¿ç”¨BD-09åæ ‡ç³»ï¼Œéœ€è¦äºŒæ¬¡è½¬æ¢
- é«˜å¾·åœ°å›¾çš„åŸç”ŸGeolocation APIå·²ç»å¾ˆå‡†ç¡®
- é«˜å¾·åœ°å›¾APIæ›´ç®€æ´æ˜“ç”¨

### Q: ç²¾åº¦è¿˜æ˜¯è¾¾ä¸åˆ°5ç±³æ€ä¹ˆåŠï¼Ÿ
A:
1. ç¡®è®¤åœ¨æˆ·å¤–å¼€é˜”åœ°ï¼ˆå»ºç­‘ç‰©ã€æ ‘æœ¨ä¼šé®æŒ¡GPSä¿¡å·ï¼‰
2. ç­‰å¾…30ç§’è®©GPSå®Œå…¨é”å®š
3. æ£€æŸ¥æ‰‹æœºGPSè®¾ç½®ï¼ˆç¡®ä¿å¼€å¯é«˜ç²¾åº¦æ¨¡å¼ï¼‰
4. æŸäº›æ‰‹æœºGPSç¡¬ä»¶ç²¾åº¦æœ‰é™ï¼ˆiPhoneé€šå¸¸æ›´å‡†ï¼‰

### Q: æ˜¯å¦éœ€è¦ä»˜è´¹æœåŠ¡ï¼Ÿ
A:
- âŒ ä¸éœ€è¦ï¼æµè§ˆå™¨Geolocation APIå®Œå…¨å…è´¹
- âŒ é«˜å¾·åœ°å›¾æ˜¾ç¤ºå…è´¹ï¼ˆæ¯å¤©30ä¸‡æ¬¡ï¼‰
- âœ… æ€»æˆæœ¬ï¼š0å…ƒ

## éƒ¨ç½²æ›´æ–°

### 1. æœ¬åœ°æµ‹è¯•
```bash
npm run dev
```

### 2. æ¨é€åˆ°GitHub
```bash
git add src/pages/Patrol.jsx
git commit -m "å‡çº§GPSå®šä½ç²¾åº¦ï¼šä½¿ç”¨åŸç”ŸAPI + ä¸‰é‡è¿‡æ»¤"
git push
```

### 3. Vercelè‡ªåŠ¨éƒ¨ç½²
- Vercelä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ä»£ç æ›´æ–°
- 2-3åˆ†é’Ÿåå®Œæˆéƒ¨ç½²
- ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€ä»»ä½•é…ç½®

## éªŒæ”¶æ ‡å‡†

### âœ… å®šä½ç²¾åº¦è¾¾æ ‡
- [ ] æˆ·å¤–å¼€é˜”åœ°ç²¾åº¦ < 20ç±³
- [ ] GPSä¿¡å·ç¨³å®šåç²¾åº¦ < 10ç±³
- [ ] è½¨è¿¹å¹³æ»‘æ— è·³ç‚¹

### âœ… åŠŸèƒ½å®Œæ•´æ€§
- [ ] ç²¾åº¦åœˆå®æ—¶æ˜¾ç¤º
- [ ] ç²¾åº¦æŒ‡ç¤ºå™¨å·¥ä½œæ­£å¸¸
- [ ] æ€»è·ç¦»è®¡ç®—å‡†ç¡®
- [ ] è¿‡æ»¤æœºåˆ¶ç”Ÿæ•ˆ

### âœ… ç”¨æˆ·ä½“éªŒ
- [ ] ç•Œé¢å“åº”æµç•…
- [ ] é”™è¯¯æç¤ºæ¸…æ™°
- [ ] æ“ä½œç®€å•ç›´è§‚

## æŠ€æœ¯æ”¯æŒ

å¦‚æœæµ‹è¯•åç²¾åº¦ä»ä¸ç†æƒ³ï¼Œè¯·æä¾›ï¼š
1. æµ‹è¯•ç¯å¢ƒï¼ˆå®¤å†…/å®¤å¤–ï¼‰
2. GPSç²¾åº¦å€¼ï¼ˆæ§åˆ¶å°æ—¥å¿—ï¼‰
3. æ‰‹æœºå‹å·å’Œæµè§ˆå™¨
4. æˆªå›¾æˆ–å½•å±

---

## ğŸ‰ æ€»ç»“

### æ ¸å¿ƒæ”¹è¿›
âœ… **ç²¾åº¦æå‡10-50å€**ï¼šä»100-500ç±³é™è‡³5-30ç±³
âœ… **æ™ºèƒ½è¿‡æ»¤**ï¼šä¸‰é‡è¿‡æ»¤æœºåˆ¶ç¡®ä¿æ•°æ®è´¨é‡
âœ… **å®æ—¶åé¦ˆ**ï¼šGPSç²¾åº¦å¯è§†åŒ–
âœ… **è·ç¦»ç»Ÿè®¡**ï¼šå‡†ç¡®è®¡ç®—å·¡é€»æ€»è·ç¦»
âœ… **é›¶æˆæœ¬æ–¹æ¡ˆ**ï¼šæ— éœ€ä»˜è´¹æœåŠ¡

### ä¸å•†ä¸šAPPå¯¹æ¯”
è¾¾åˆ°äº†æ‰“è½¦APPå’ŒKeepçš„å®šä½ç²¾åº¦æ°´å¹³ï¼Œå®Œå…¨æ»¡è¶³é«˜é“å·¡é€»éœ€æ±‚ï¼

**ç«‹å³éƒ¨ç½²æµ‹è¯•ï¼Œä½“éªŒä¸“ä¸šçº§GPSè¿½è¸ªï¼** ğŸš€
