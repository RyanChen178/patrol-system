# 百度地图配置指南

## 🎯 为什么换成百度地图？

高德地图定位偏移近1公里，无法解决。百度地图：
- ✅ 使用 BD-09 坐标系（百度独有）
- ✅ 定位算法更准确
- ✅ 完全免费（日配额30万次）
- ✅ 国内访问稳定

## 📝 快速配置（5分钟）

### 步骤1：申请百度地图AK

1. **访问百度地图开放平台**
   - 地址：https://lbsyun.baidu.com/apiconsole/key/create

2. **登录百度账号**
   - 如果没有账号，注册一个（免费）

3. **创建应用**
   - 点击"创建应用"
   - 应用名称：`高铁巡逻系统`
   - 应用类型：选择 `浏览器端`
   - Referer白名单：输入 `*`（允许所有域名）
   - 点击"提交"

4. **获取AK**
   - 创建成功后，页面会显示您的AK
   - 复制这个AK（类似：`abcdefghijklmnopqrstuvwxyz123456`）

### 步骤2：配置项目

打开 `index.html` 文件，找到这一行：

```html
<script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=YOUR_BAIDU_MAP_AK"></script>
```

将 `YOUR_BAIDU_MAP_AK` 替换为您刚才复制的AK：

```html
<script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=您的AK"></script>
```

**示例**：
```html
<script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=abcdefghijklmnopqrstuvwxyz123456"></script>
```

### 步骤3：测试

```bash
# 本地测试
npm run dev

# 构建部署
npm run build
git add .
git commit -m "切换到百度地图"
git push
```

## ✅ 验证效果

打开浏览器开发者工具（F12），查看Console：

**成功**：
```
✓ 初始定位成功: 116.404 39.915 精度: 25.3 米
✓ 巡逻已开始，使用百度地图定位（BD-09坐标系）
✓ 记录位置点 #1, 精度: 18.7米
```

**失败（需要配置AK）**：
```
百度地图加载失败，请检查网络连接
```

## 📊 百度地图 vs 高德地图

| 对比项 | 高德地图 | 百度地图 |
|--------|---------|---------|
| 坐标系 | GCJ-02（火星坐标）| BD-09（百度坐标）|
| 您的测试结果 | ❌ 偏移近1公里 | ⏳ 待测试 |
| 定位算法 | GPS+WiFi+基站 | GPS+WiFi+基站+POI |
| 免费额度 | 30万次/天 | 30万次/天 |
| 国内稳定性 | ✅ 好 | ✅ 好 |

## 🎯 预期效果

百度地图定位通常比高德更准，因为：
1. 自己的BD-09坐标系，专门优化
2. 加入POI（兴趣点）辅助定位
3. 国内地图数据更详细

**预期精度**：10-50米（户外开阔地）

## 📱 测试建议

### 1. 标志性建筑测试
站在明显地标（学校/商场）前：
- 打开系统，开始巡逻
- 观察蓝色标记位置
- 应该在您附近（±50米内）

### 2. 对比测试
同时打开：
- 本系统
- 百度地图APP

两者显示位置应该一致！

### 3. 行走测试
- 走一段直线（50米）
- 轨迹应该平滑流畅
- 无大幅跳点

## ⚠️ 常见问题

### Q: 申请AK要钱吗？
A: 完全免费！每天30万次配额，个人使用完全够用。

### Q: 为什么要配置Referer白名单为 `*`？
A:
- 开发测试时：localhost可以访问
- 部署后：vercel.app域名可以访问
- 生产环境建议改为具体域名（更安全）

### Q: 地图还是不准怎么办？
A:
1. 确认在户外开阔地测试
2. 等待30秒让GPS完全锁定
3. 查看GPS精度值（应该<100米）
4. 如果百度也不行，可能是手机GPS硬件问题

### Q: 能否回到高德地图？
A: 可以！只需修改 index.html 和 Patrol.jsx，恢复之前的代码。

## 🔄 回滚方案

如果百度地图也不行，我们还有：
1. 腾讯地图（也是GCJ-02）
2. Leaflet + OpenStreetMap（WGS-84，国际标准）
3. 自定义坐标转换算法

## 📞 申请遇到问题？

如果申请百度地图AK遇到问题：
1. 截图申请页面
2. 提供错误提示
3. 我可以帮您排查

## 🎉 配置完成后

立即推送测试：

```bash
git add .
git commit -m "切换到百度地图定位

- 使用BD-09坐标系
- 更换定位算法
- 预期精度提升至10-50米
- 修复高德地图偏移1公里问题

Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>"

git push
```

等待2-3分钟Vercel部署完成，然后户外实测！

---

**期待百度地图能解决定位偏移问题！** 🚀
